<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>68.axios的实现原理</title>
</head>

<body>
    <script>
        /**
            axios是一个基于Promise的http请求库,可用于浏览器和 Node。可以说是目前最为常用的http库。
            axios与ajax的区别：
            axios其实是对ajax的一个封装，并通过一个promise对象来对结果进行处理

            优缺点：
            ajax：
                本身是针对MVC的编程,不符合现在前端MVVM的浪潮
                基于原生的XHR开发，XHR本身的架构不清晰，已经有了fetch的替代方案
                JQuery整个项目太大，单纯使用ajax却要引入整个JQuery非常的不合理（采取个性化打包的方案又不能享受CDN服务
            axios：
                从 node.js 创建 http 请求
                支持 Promise API
                客户端支持防止CSRF
                提供了一些并发请求的接口
        */

        // 先实现ajax请求
        var Ajax = {
            get: function (url, fn) {
                // XMLHttpRequest对象用于在后台与服务器交换数据
                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function () {
                    // readyState == 4说明请求已完成
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // 从服务器获得数据
                        fn.call(this, xhr.responseText);
                    }
                };
                xhr.send();
            }
        }

        // 在ajax的基础上加上promise的封装，形成axios
        var Axios = {
            get: function (url) {
                return new Promise((resolve, reject) => {
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', url, true);
                    xhr.onreadystatechange = function () {
                        // readyState == 4说明请求已完成
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            // 从服务器获得数据
                            resolve(xhr.responseText)
                        }
                    };
                    xhr.send();
                })
            },
        }
    </script>

</body>


</html>